<ng-container *ngIf="paymentGatewayLoading.isRunning();">
    <ws-spinner class="text-center d-block w-100" style="padding: 30vh 0"></ws-spinner>
</ng-container>
<div [hidden]="paymentGatewayLoading.isRunning()" *ngIf="selectedPackage; else noPackageTemplate">
    <div *ngIf="isPaymentGatewayDisplayed" class="text-center py-4">
        <p class="mb-0">You have selected <span class="font-weight-bold">{{selectedPackage.name}}</span> plan</p>
        <a style="color: #0645AD" (click)="navigateToChangePlan()">Change plan</a>
    </div>
    <div *ngIf="isPaymentGatewayDisplayed" class="row no-gutters">
        <div class="w-100 center p-4 font-9 shadow" style="border-radius: 10px">
            <h6 class="font-9">Summary</h6>
            <p class="mb-0">{{selectedPackage.name}}
                <span *ngIf="((selectedPackage.ori_price_per_unit * selectedPackage.month) - selectedPackage.price) / (selectedPackage.ori_price_per_unit * selectedPackage.month) * 100 != 0">(-{{((selectedPackage.ori_price_per_unit * selectedPackage.month) - selectedPackage.price) / (selectedPackage.ori_price_per_unit * selectedPackage.month) * 100 | number: '1.2-2'}}%)</span>
                <span class="float-right" [style.text-decoration]="selectedPackage.price != (selectedPackage.ori_price_per_unit * selectedPackage.month).toFixed(2) ? 'line-through': 'none'">RM {{selectedPackage.ori_price_per_unit * selectedPackage.month | number: '1.2-2'}}</span></p>
            <p *ngIf="selectedPackage.price != (selectedPackage.ori_price_per_unit * selectedPackage.month).toFixed(2)"><span class="float-right font-weight-bold">RM {{selectedPackage.price}}</span></p>
            <div class="clearfix"></div>
            <p class="mb-0">Subscription<span class="float-right">x {{selectedPackage.month}} month</span></p>
            <hr/>
            <p class="mb-0">Total <span class="float-right font-weight-bold">RM {{selectedPackage.price}}</span></p>
            <div class="clearfix"></div>
            <div *ngIf="selectedPackage.ori_price_per_unit * selectedPackage.month != selectedPackage.price">
                <span class="float-right text-danger font-8 font-weight-bold">(SAVE RM {{(selectedPackage.ori_price_per_unit * selectedPackage.month) - (+selectedPackage.price) | number: '1.2-2'}})</span>
            </div>
            <div class="clearfix"></div>
            <form [formGroup]="paymentGatewayForm">
                <h6 class="font-9">Billing information</h6>
                <div class="row no-gutters">
                    <div class="col-lg-6 mb-2 pr-2">
                        <input class="form-control form-control-sm" placeholder="First name" name="firstName" maxlength="40" formControlName="firstName"/>
                    </div>
                    <div class="col-lg-6 mb-2">
                        <input class="form-control form-control-sm" placeholder="Last name" name="lastName" maxlength="40" formControlName="lastName"/>
                    </div>
                </div>
                <input class="form-control form-control-sm mb-2" placeholder="Email address" name="email" maxlength="30" formControlName="email"/>
                <input class="form-control form-control-sm mb-2" placeholder="Phone number" name="phone" maxlength="20" formControlName="phone"/>
                <div class="row no-gutters mb-3">
                    <div class="col-lg-6 mb-2 pr-2">
                        <mat-select placeholder="Country" class="form-control form-control-sm font-9" style="height: 31px" name="countryName" formControlName="countryName">
                            <mat-option [value]="country" *ngFor="let country of countries.values">{{country}}</mat-option>
                        </mat-select>
                    </div>
                    <div class="col-lg-6 mb-2">
                        <div id="postal-code" class="form-control form-control-sm"></div>
                    </div>
                </div>
                <h6 class="font-9">Payment methods</h6>
                <div id="card-number" class="form-control form-control-sm mb-2"></div>
                <div class="row no-gutters mb-3">
                    <div class="col-lg-6 mb-2 pr-2">
                        <div id="expiration-date" class="form-control form-control-sm"></div>
                    </div>
                    <div class="col-lg-6 mb-2">
                        <div id="cvv" class="form-control form-control-sm"></div>
                    </div>
                </div>
                <div class="float-right mb-2">
                    <button id="submit" (click)="subscribeNow(form)" [disabled]="subscribeLoading?.isRunning()" class="btn btn-second">
                        <ws-spinner *ngIf="subscribeLoading?.isRunning()" [width]="15" [height]="15" [spinnerColor]="'#fff'" [borderWidth]="3" class="mr-2"></ws-spinner>Subscribe</button>
                </div>
            </form>
            <div class="clearfix"></div>
            <img class="mb-2" src="assets/images/png/payment-secure.png" alt="payment-secure" />
            <p class="font-8 text-muted">Your subscription will automatically renew on the new billing date.<br/>By purchasing, you agreed to Terms of Service.</p>
        </div>
    </div>
    <div *ngIf="!isPaymentGatewayDisplayed" class="row no-gutters">
        <div class="center p-4 font-9 shadow" style="border-radius: 10px">
            <p class="mb-0">Your next month package will be charged on 
                <span class="font-weight-bold">{{selectedPackage.name}}</span>.</p>
            <p>Total price: <span class="font-weight-bold">RM {{ selectedPackage.price }}</span></p>
            <div class="float-right">
                <button class="btn btn-sm btn-controller mr-2" [disabled]="subscribeLoading?.isRunning()" (click)="_changeNextMonthPackageCallback()">
                    <ws-spinner *ngIf="subscribeLoading?.isRunning()" [width]="15" [height]="15" [spinnerColor]="'#fff'" [borderWidth]="3" class="mr-2"></ws-spinner>Confirm</button>
                <button class="btn btn-sm btn-controller" (click)="navigateToChangePlan()">Cancel</button>
            </div>
        </div>
    </div>
</div>

<ng-template #noPackageTemplate>
    <div class="h5 text-muted text-center font-weight-light" style="padding-top: 10vh; padding-bottom: 10vh">
        No Package
    </div>
</ng-template>