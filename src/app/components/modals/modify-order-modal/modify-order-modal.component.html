<ws-modal *ngIf="isOpened" [(isOpened)]="isOpened" [isCloseIconDisplayed]="false" [maxWidth]="700">
    <form modalBody [formGroup]="form">
        <mat-select class="form-control form-control-sm mb-2 border-0 float-right status-container" style="width: 150px; padding-top: .35rem" placeholder="Status" formControlName="status"
        [ngClass]="'status-container-' + form.controls['status'].value" (selectionChange)="updateOrderReceiptStatus($event.value)">
            <mat-option [value]="'new'" *ngIf="!item || item.status == 'new' || item.status == 'paid' || item.status == 'completed' || item.status == 'refunded' || item.status == 'cancelled'">New</mat-option>
            <mat-option [value]="'paid'" *ngIf="item && (item.status == 'paid' || item.status == 'in_progress')">Paid</mat-option>
            <mat-option [value]="'in_progress'" *ngIf="item && (item.status == 'paid' || item.status == 'in_progress' || item.status == 'delivered')">In Progress</mat-option>
            <mat-option [value]="'delivered'" *ngIf="item && (item.status == 'in_progress' || item.status == 'delivered')">Delivered</mat-option>
            <mat-option [value]="'cancelled'" *ngIf="item && (item.status == 'cancelled' || item.status == 'refunded')">Cancelled</mat-option>
            <mat-option [value]="'refunded'" *ngIf="item && (item.status == 'cancelled' || item.status == 'refunded')">Refunded</mat-option>
            <mat-option [value]="'completed'" *ngIf="item && (item.status == 'delivered' || item.status == 'completed')">Completed</mat-option>
        </mat-select>
        <p class="mb-0 font-8" *ngIf="item">ID: {{ item?.receiptId }}</p>
        <div class="font-8 mb-2" *ngIf="item">
            <p class="mb-0" style="color: #6b778c" *ngIf="item.createdAt">Created {{ item?.createdAt | date: 'MMM d, y, h:mm a'}}</p>
            <p class="mb-0" style="color: #6b778c" *ngIf="item.updatedAt">Updated {{ item?.updatedAt | date: 'MMM d, y, h:mm a'}}</p>
        </div>
        <mat-select class="form-control form-control-sm mb-2" placeholder="Catalogue" [disabled]="!isEditable()" (selectionChange)="getItems($event.value)">
            <mat-option [value]="'uncategorized'">Uncategorized</mat-option>
            <mat-option [value]="category.id" *ngFor="let category of categories">{{ category?.name }}</mat-option>
        </mat-select>
        <div class="border rounded mb-3 p-3">
            <ws-search-select [items]="items" [placeholder]="'Item'" [loading]="itemLoading.isRunning()" (selectionChange)="selectionChange($event)" (searchValueChange)="searchItemValueChange($event)" (scroll)="getItems(categoryId, true)" (open)="openItemChange($event)" [class.disabled]="!isEditable()" class="d-block form-control form-control-sm mb-2"></ws-search-select>
            <mat-select class="form-control form-control-sm mb-2" placeholder="Item Type" formControlName="itemType">
                <mat-option [value]="itemType.name" *ngFor="let itemType of selectedItem?.types">{{itemType.name}}</mat-option>
            </mat-select>
            <div class="row no-gutters mb-2">
                <div class="col-lg-6 pr-2">
                    <input class="form-control form-control-sm" placeholder="Price" formControlName="itemPrice" />
                </div>
                <div class="col-lg-6">
                    <input class="form-control form-control-sm" placeholder="Quantity" formControlName="itemQuantity" />
                </div>
            </div>
            <div>
                <button [disabled]="!isEditable()" class="float-right btn btn-controller btn-sm" (click)="addItem()">
                    <span class="fas fa-plus mr-2 d-inline-block"></span>
                    Add Item
                </button>
            </div>
            <div class="clearfix"></div>
        </div>
        <div class="mb-3">
            <h5 class="h6">Items ({{inListItems.length}})</h5>
            <ul class="list-group font-9" *ngIf="inListItems.length">
                <li class="list-group-item d-flex align-items-center" *ngFor="let targetItem of inListItems">
                    <span class="col p-0">{{ targetItem.name }} {{ targetItem.type !== 'default' ? '- ' + targetItem.type : '' }} - RM {{ targetItem.price  | number: '1.2-2' }} x {{ targetItem.quantity}} </span>
                    <span class="px-1">RM {{ targetItem.price * targetItem.quantity | number: '1.2-2' }}</span>
                    <span *ngIf="isEditable()" class="fas fa-times pl-2 clickable" (click)="removeItem(targetItem)"></span>
                </li>
            </ul>
            <p class="text-center py-3 d-block font-9" *ngIf="!inListItems.length">No Item</p>
        </div>
        <div class="mb-3">
            <h5 class="h6">Delivery Fee</h5>
            <input class="form-control form-control-sm" placeholder="Price ($)" formControlName="deliveryFee" (input)="notifyCalculation()"/>
        </div>
        <div class="mb-3">
            <h5 class="h6">Promotion</h5>
            <mat-select class="form-control form-control-sm" placeholder="Promotion" (selectionChange)="notifyCalculation()" formControlName="promotion">
                <mat-option [value]="''">No promotion</mat-option>
                <mat-option [value]="promotion._id" *ngFor="let promotion of promotions">{{ promotion.title }}</mat-option>
            </mat-select>
        </div>
        <div class="mb-3">
            <h5 class="h6">Calculation</h5>
            <div class="border rounded p-3">
                <table class="float-right font-9">
                    <tr *ngIf="form.controls['deliveryFee'].value !== ''">
                        <td class="font-weight-bold">Delivery (MYR):</td>
                        <td class="text-right" style="width: 150px">{{ delivery | number: '1.2-2' }}</td>
                    </tr>
                    <tr>
                        <td class="font-weight-bold">Subtotal (MYR):</td>
                        <td class="text-right" style="width: 150px">{{ subtotal | number: '1.2-2' }}</td>
                    </tr>
                    <tr>
                        <td class="font-weight-bold">Discount (MYR):</td>
                        <td class="text-right" style="width: 150px">{{ discount | number: '1.2-2' }}</td>
                    </tr>
                    <tr>
                        <td class="font-weight-bold">Total (MYR):</td>
                        <td class="text-right" style="width: 150px">{{ total | number: '1.2-2' }}</td>
                    </tr>
                </table>
                <div class="clearfix"></div>
            </div>
        </div>
        <hr />
        <div class="mb-3">
            <h5 class="h6">Delivery Details</h5>
            <div class="row no-gutters">
                <div class="col-lg-6 pr-lg-1">
                    <input class="form-control form-control-sm mb-2" maxlength="36" placeholder="First Name" formControlName="firstName" />
                </div>
                <div class="col-lg-6 pl-lg-1">
                    <input class="form-control form-control-sm mb-2" maxlength="36" placeholder="Last Name" formControlName="lastName" />
                </div>
            </div>
            <div class="mb-2">
                <div class="mb-2">
                    <input class="form-control form-control-sm" maxlength="128" placeholder="Delivery Address" formControlName="address"/>
                </div>
                <div class="row no-gutters">
                    <div class="col-lg-4 pr-lg-2">
                        <input class="form-control form-control-sm" maxlength="36" formControlName="postcode" placeholder="Post Code" />
                    </div>
                    <div class="col-lg-4 pr-lg-2">
                        <mat-select class="form-control form-control-sm" formControlName="state" placeholder="State">
                            <mat-option [value]="''">Select a state</mat-option>
                            <mat-option [value]="_state" *ngFor="let _state of states">{{ _state }}</mat-option>
                        </mat-select>
                    </div>
                    <div class="col-lg-4">
                        <mat-select class="form-control form-control-sm" formControlName="country" placeholder="Country">
                            <mat-option [value]="''">Select a country</mat-option>
                            <mat-option [value]="'MYS'">Malaysia</mat-option>
                        </mat-select>
                    </div>
                </div>
            </div>
            <input class="form-control form-control-sm mb-2" placeholder="Contact Tel" maxlength="36" formControlName="phoneNumber" />
            <mat-checkbox [color]="'primary'" class="pt-1 mr-2 d-inline-block" formControlName="isCustomerSaved">
                <span class="font-8 align-middle">Check to save customer</span>
            </mat-checkbox>
        </div>
        <div class="mb-3">
            <h5 class="h6">ETA Delivery Date</h5>
            <div class="row no-gutters">
                <input (click)="fromPicker.open()" placeholder="Date" [min]="todayDate" formControlName="etaDate" class="form-control form-control-sm mb-2 mr-3" style="max-width: 200px" [matDatepicker]="fromPicker" />
                <mat-datepicker #fromPicker startView="month" [startAt]="todayDate"></mat-datepicker>
                <div class="input-group" style="width: 150px">
                    <mat-select class="form-control form-control-sm" placeholder="HH" formControlName="etaDateTimeHour">
                        <mat-option [value]="''">HH</mat-option>
                        <mat-option [value]="n" *ngFor="let n of hours">{{n}}</mat-option>
                    </mat-select>
                    <mat-select class="form-control form-control-sm" placeholder="MM" formControlName="etaDateTimeMin">
                        <mat-option [value]="''">MM</mat-option>
                        <mat-option [value]="n" *ngFor="let n of mins">{{n}}
                        </mat-option>
                    </mat-select>
                </div>
            </div>  
        </div>
        <div class="mb-3">
            <h5 class="h6">Remark</h5>
            <textarea class="form-control form-control-sm" rows="5" maxlength="300" placeholder="Write remark here" formControlName="remark"></textarea>
        </div>
        <div>
            <div class="d-inline-block float-right">
                <button *ngIf="isEditable()" class="btn btn-controller btn-sm mr-2" [disabled]="modifyLoading.isRunning()" (click)="modifyItem()">
                    <ws-spinner class="mr-2" *ngIf="modifyLoading.isRunning()" [width]="15" [height]="15" [borderWidth]="1" [spinnerColor]="'#b71c1c'"></ws-spinner>{{item ? 'Save' : 'Create'}}</button>
                <button class="btn btn-controller btn-sm" (click)="close()">Cancel</button>
            </div>
        </div>
    </form>
</ws-modal>

<confirm-modal *ngIf="isCreateEmptyOrderModalOpened" [(isOpened)]="isCreateEmptyOrderModalOpened" id="removeItemsModal" [loading]="modifyLoading.isRunning()" [message]="'Are you sure the order is empty?'" [action]="modifyCallback.bind(this, tempOrder)">
</confirm-modal>