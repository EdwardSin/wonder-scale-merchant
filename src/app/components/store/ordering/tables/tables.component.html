<h4 class="ws-title">Tables</h4>

<div class="row no-gutters">
    <div class="col-lg mr-1">
        <button title="Download" class="btn btn-controller small" (click)="openDownloadModal()">
            <span class="fas fa-qrcode"></span>
        </button>
    </div>
    
    <div class="col-auto">
        <div class="row no-gutters order-2 center">
            <div class="ws-circle-button">
                <button title="Import Tables" wsTippy class="btn btn-controller small" (click)="isImportTablesModalOpened = true">
                    <span class="fa fa-upload"></span>
                </button>
            </div>
            <div class="ws-circle-button" (click)="isModifyTableModalOpened = true">
                <button title="Add Table" wsTippy class="btn btn-controller small">
                    <span class="fa fa-plus"></span>
                </button>
            </div>
        </div>
    </div>
</div>

<table class="table table-hover w-100 font-9">
    <thead>
        <th>Status</th>
        <th>Table No</th>
        <th>Maximum Persons</th>
        <th style="width: 100px">Actions</th>
    </thead>
    <tbody>
        <tr *ngFor="let table of tables">
            <td class="text-capitalize" style="width: 50px">{{ table.status }}</td>
            <td>{{ table.tableNo }}</td>
            <td>{{ table.maxPersons }}</td>
            <td>
                <div class="d-inline-block" #dropdown="bs-dropdown" mdbDropdown>
                    <button title="Settings" mdbDropdownToggle wsTippy class="btn btn-sm btn-controller d-inline-block d-sm-inline-flex">
                        <span class="fas fa-cog"></span>
                    </button>
                    <div class="dropdown-menu dropdown-menu-right mt-0 pb-0 pt-0">
                        <button class="dropdown-item" (click)="openModifyModal(table)">Edit</button>
                        <button class="dropdown-item" (click)="openRemoveTableModal(table)">Remove</button>
                    </div>
                </div>
            </td>
        </tr>
    </tbody>
</table>

<ng-container *ngIf="tables.length && !loading.isRunning(); else loadingTemplate"></ng-container>

<ws-modal *ngIf="isModifyTableModalOpened" [maxWidth]="400" [isCloseIconDisplayed]="false">
    <div modalBody>
        <div class="font-9">
            <div class="mb-2">
                <label class="mb-0">Table No:*</label>
                <input class="form-control form-control-sm" name="tableNo" [(ngModel)]="tableNo" />
            </div>
            <div class="mb-2">
                <label class="mb-0">Maximum Persons:*</label>
                <mat-select class="form-control form-control-sm" name="maxPersons" [(ngModel)]="maxPersons">
                    <mat-option *ngFor="let person of maxPersonsArray" [value]="person">{{ person }}</mat-option>
                </mat-select>
            </div>
            <div class="mb-2">
                <label class="mb-0">Status:</label>
                <mat-select class="form-control form-control-sm" [(ngModel)]="status">
                    <mat-option value="available">Available</mat-option>
                    <mat-option value="occupied">Occupied</mat-option>
                    <mat-option value="repaired">Repaired</mat-option>
                </mat-select>
            </div>
        </div>
        <div class="row no-gutters float-right">
            <button class="btn btn-sm btn-controller mr-2" (click)="selectedTable ? updateTable() : addTable()">
                <ws-spinner *ngIf="modifyLoading.isRunning()" class="mr-2" [width]="15" [height]="15" [borderWidth]="3"></ws-spinner>{{ selectedTable ? 'Edit': 'Add' }}</button>
            <button class="btn btn-sm btn-controller" (click)="closeModifyModal()">Cancel</button>
        </div>
    </div>
</ws-modal>

<import-tables-modal *ngIf="isImportTablesModalOpened" [(isOpened)]="isImportTablesModalOpened"></import-tables-modal>

<ws-modal *ngIf="isQrcodeActionModalOpened" [(opened)]="isQrcodeActionModalOpened" [maxWidth]="800" [isCloseIconDisplayed]="false">
    <div modalBody>
        <div *ngIf="tables.length && !loading.isRunning(); else loadingTemplate" class="mb-3">
            <div style="width:120px" class="input-group input-group-sm pr-1 mb-2">
                <input name="qr-size" placeholder="75 - 300" class="form-control" (keydown.enter)="refreshQrcodes($event.target.value)" [ngModel]="qrcodeSize" />
                <div class="input-group-append">
                    <span class="input-group-text">px</span>
                </div>
            </div>
            <div class="row no-gutters">
                <ul class="mb-0 col font-9 p-3">
                    <li>You may stick the QR-codes to the corresponding tables to connect to your store.</li>
                    <li>Test before using the printed QR-codes.</li>
                </ul>
                <div class="qrcode-container">
                    <p>Example:</p>
                    <div *ngFor="let table of tables" #qrcode [attr.data-url]="url + table._id" class="qrcode d-none p-2"></div>
                    <div #targetQrcode class="qrcode center" [style.width.px]="qrcodeSize">
                        <ws-spinner style='line-height: 200px; display: block' class="text-center"></ws-spinner>
                    </div>
                </div>
            </div>
        </div>
        <div class="row no-gutters float-right">
            <button [disabled]="!tables.length" class="btn btn-sm btn-controller mr-2" (click)="generateZIP()">Download</button>
            <button class="btn btn-sm btn-controller" (click)="closeDownloadModal()">Cancel</button>
        </div>
    </div>
</ws-modal>

<confirm-modal *ngIf="isRemoveConfirmationModalOpened" [(isOpened)]="isRemoveConfirmationModalOpened" [loading]="removeLoading.isRunning()" [message]="'Are you sure to remove the selected table?'" [action]="removeTable.bind(this)">
</confirm-modal>

<ng-template #loadingTemplate>
    <ws-spinner *ngIf="loading.isRunning(); else noTableTemplate" class="text-center d-block w-100" style="padding-top: 10vh; padding-bottom: 10vh"></ws-spinner>
</ng-template>
<ng-template #noTableTemplate>
    <div class="w-100">
      <div class="h5 text-muted text-center font-weight-light" style="padding-top: 10vh; padding-bottom: 10vh">
        No Table
      </div>
    </div>
</ng-template>