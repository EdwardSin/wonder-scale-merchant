<div class="row no-gutters" (clickOutside)="clear()">
  <input #addressInput name="address" autocomplete="off" class="form-control form-control-sm nooutline"
  placeholder="Address" 
    (keydown.enter)="mapController.onAddressChanged();" 
    (keydown)="mapController.selectAddress($event)" (focus)="mapController.displayed = true" 
    (input)="address.valueChanged(); mapController.valueChanged(mapController.address.address)"
    [(ngModel)]="mapController.address.address" [disabled]="disabled"/>
  <div class="position-relative w-100">
    <ul class="list-group suggestions" *ngIf="mapController?.suggestions?.length && mapController?.displayed">
      <li [class.hover]="mapController.hovered == i" *ngFor="let suggestion of mapController?.displaySuggestions; let i = index;"
        (click)="$event.stopPropagation(); mapController.hovered = i; mapController.onAddressChanged()">
        <span class="ws-main fas fa-map-marker-alt pr-2"></span>{{suggestion}}</li>
    </ul>
  </div>

  <div class="row no-gutters w-100 mt-2">
    <input #postcodeInput name="postcode" autocomplete="nope" [class.has-error]="address?.errors?.postcode != ''" class="pl-2 form-control form-control-sm col-lg-3 nooutline"
      (input)="address.valueChanged()" placeholder="Postcode" [(ngModel)]="address.postcode"  [disabled]="disabled"/>
    <input #stateInput name="state" autocomplete="nope" [class.has-error]="address?.errors?.state != ''" class="pl-2 form-control form-control-sm col-lg-3 mt-2 mt-lg-0 offset-lg-1 nooutline"
      (input)="address.valueChanged()" placeholder="State" [(ngModel)]="address.state"  [disabled]="disabled"/>
    <select #countryInput name="country" id="country-select" [class.has-error]="address?.errors?.country != ''" class="pl-2 form-control form-control-sm col-lg-4 mt-2 mt-lg-0 offset-lg-1 nooutline"
      tabIndex="4" style="color:#888" (input)="address.valueChanged()" [(ngModel)]="address.country" [disabled]="disabled">
      <option value="" disabled selected>Country</option>
      <option [value]="country" *ngFor="let country of data?.value">{{country}}</option>
    </select>
  </div>
  <div class="row no-gutters w-100">
    <p *ngIf="address?.errors?.postcode != ''" class="offset-2 mb-0 text-danger">{{address?.errors?.postcode}}</p>
    <p *ngIf="address?.errors?.state != ''" class="offset-5 mb-0 text-danger">{{address?.errors?.state}}</p>
    <p *ngIf="address?.errors?.country != ''" class="offset-9 mb-0 text-danger">{{address?.errors?.country}}</p>
  </div>
  <p class="text-muted mb-0 mt-2">*Click to set the accurate location for your customer</p>
  <div class="border mb-3 w-100 position-relative">
    <div class="w-100 map-screen" *ngIf="disabled"></div>
    <agm-map class="w-100" [longitude]="mapController.mapLng" [latitude]="mapController.mapLat" [zoom]="14" [gestureHandling]="'greedy'"
      [maxZoom]="17" [minZoom]="11" [streetViewControl]="false" panControl="false" zoomControl="false" (mapClick)="mapController.mapClick($event)">
      <agm-marker [longitude]="mapController.markerLng" [latitude]="mapController.markerLat"></agm-marker>
    </agm-map>
    <div *ngIf="mapController.locationLoading.isRunning()" class="w-100 h-100 map-screen">
      <ws-spinner class="loading"></ws-spinner>
    </div>
  </div>
  <input name="lng" hidden class="form-control form-control-sm nooutline" type="text" [(ngModel)]="mapController.markerLng"
  />
  <input name="lat" hidden class="form-control form-control-sm nooutline" type="text" [(ngModel)]="mapController.markerLat"
  />
</div>